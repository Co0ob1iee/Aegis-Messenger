<UserControl
    x:Class="Aegis.Desktop.Controls.DisappearingMessagesControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <StackPanel Spacing="16">
        <!-- Header -->
        <StackPanel Spacing="8">
            <TextBlock Text="Disappearing Messages"
                      FontSize="20"
                      FontWeight="SemiBold"/>
            <TextBlock Text="Set a timer for messages to automatically disappear after being read."
                      TextWrapping="Wrap"
                      Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                      FontSize="14"/>
        </StackPanel>

        <!-- Enable/Disable Toggle -->
        <ToggleSwitch x:Name="EnableToggle"
                     Header="Enable Disappearing Messages"
                     IsOn="{x:Bind ViewModel.IsEnabled, Mode=TwoWay}"
                     Toggled="EnableToggle_Toggled"/>

        <!-- Timer Selection -->
        <StackPanel Spacing="12"
                   Visibility="{x:Bind ViewModel.IsEnabled, Mode=OneWay}">

            <TextBlock Text="Delete messages after:"
                      FontWeight="SemiBold"
                      FontSize="14"/>

            <!-- Timer Options -->
            <ListView x:Name="TimerListView"
                     ItemsSource="{x:Bind ViewModel.Timers}"
                     SelectedItem="{x:Bind ViewModel.SelectedTimer, Mode=TwoWay}"
                     SelectionMode="Single"
                     Height="300"
                     BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                     BorderThickness="1"
                     CornerRadius="8">
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <Grid Padding="16,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Text="{Binding Label}"
                                      VerticalAlignment="Center"
                                      FontSize="14"/>

                            <FontIcon Grid.Column="1"
                                     Glyph="&#xE73E;"
                                     FontSize="16"
                                     Foreground="{ThemeResource AccentFillColorDefaultBrush}"
                                     Visibility="{Binding IsSelected, Mode=OneWay}"/>
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>

            <!-- Info Text -->
            <InfoBar IsOpen="True"
                    Severity="Informational"
                    IsClosable="False"
                    Message="The timer starts when the recipient reads the message. You'll be notified before messages disappear."/>
        </StackPanel>

        <!-- Warning when disabled -->
        <InfoBar x:Name="DisabledWarning"
                Severity="Warning"
                IsOpen="True"
                IsClosable="False"
                Title="Disappearing messages are off"
                Message="Messages in this conversation will not disappear automatically."
                Visibility="{x:Bind ViewModel.IsDisabled, Mode=OneWay}"/>

        <!-- Apply Button -->
        <Button Content="Apply Settings"
               Command="{x:Bind ViewModel.ApplyCommand}"
               Style="{ThemeResource AccentButtonStyle}"
               HorizontalAlignment="Right"/>
    </StackPanel>
</UserControl>
